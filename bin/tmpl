#!/bin/sh

_tmpl() {
  local src=$(dirname $0)/../$1
  local dest=$2
  local tmp=$(mktemp)
  local diff

  trap 'rm $tmp' 1 2 3 15

  tmpl.awk $src > $tmp
  diff=$(diff $dest $tmp)

  [ $? -eq 0 ] && return

  progress start tmpl $dest

  cat $tmp > $dest
  progress finish $?
  progress result "$diff"
}

_tmpl "$@"
